Only in rodinia_3.1-patched/opencl/backprop: backprop
Only in rodinia_3.1-patched/opencl/backprop: backprop.o
diff -ru rodinia_3.1/opencl/backprop/backprop_ocl.cpp rodinia_3.1-patched/opencl/backprop/backprop_ocl.cpp
--- rodinia_3.1/opencl/backprop/backprop_ocl.cpp	2015-12-11 16:46:38.000000000 +0100
+++ rodinia_3.1-patched/opencl/backprop/backprop_ocl.cpp	2016-07-21 15:01:33.152201597 +0200
@@ -12,6 +12,7 @@
 	#include <CL/cl.h>
 #endif
 
+static struct timeval t_start, t_end;
 
 ////////////////////////////////////////////////////////////////////////////////
 
@@ -183,6 +184,13 @@
 	if(err != CL_SUCCESS) { printf("ERROR: clCreateBuffer input_prev_weights_ocl\n"); return -1;}
 		
 	printf("Performing GPU computation\n");
+
+        int run;
+        int runs = atoi(getenv("RODINIA_RUNS"));
+        FILE* runtimes = fopen("runtimes", "w");
+
+        for (run = 0; run < runs; run++) {
+          gettimeofday(&t_start, NULL);
 	
 	//write buffers
 	err = clEnqueueWriteBuffer(cmd_queue, input_ocl, 1, 0, (in + 1) * sizeof(float), net->input_units, 0, 0, 0);
@@ -235,7 +243,13 @@
 	clSetKernelArg(kernel2, 5, sizeof(void *), (void*) &input_prev_weights_ocl );
   
 	err = clEnqueueNDRangeKernel(cmd_queue, kernel2, 2, NULL, global_work, local_work, 0, 0, 0);
-	if(err != CL_SUCCESS) { printf("ERROR: 1  clEnqueueNDRangeKernel()=>%d failed\n", err); return -1; }	
+	if(err != CL_SUCCESS) { printf("ERROR: 1  clEnqueueNDRangeKernel()=>%d failed\n", err); return -1; }
+        clFinish(cmd_queue);
+        gettimeofday(&t_end, NULL);
+        fprintf(runtimes, "%d\n",
+                (t_end.tv_sec*1000000+t_end.tv_usec) - (t_start.tv_sec*1000000+t_start.tv_usec));
+        }
+        fclose(runtimes);
   
 	err = clEnqueueReadBuffer(cmd_queue, input_ocl, 1, 0, (in + 1) * sizeof(float), net->input_units, 0, 0, 0);
 	if(err != CL_SUCCESS) { printf("ERROR: 1  clEnqueueReadBuffer: input_ocl\n"); return -1; }	
Only in rodinia_3.1-patched/opencl/backprop: facetrain.o
Only in rodinia_3.1-patched/opencl/backprop: imagenet.o
diff -ru rodinia_3.1/opencl/backprop/run rodinia_3.1-patched/opencl/backprop/run
--- rodinia_3.1/opencl/backprop/run	2015-12-11 16:46:38.000000000 +0100
+++ rodinia_3.1-patched/opencl/backprop/run	2016-07-21 14:56:44.880736763 +0200
@@ -1 +1 @@
-./backprop 65536
\ No newline at end of file
+./backprop 1048576
\ No newline at end of file
Only in rodinia_3.1-patched/opencl/backprop: runtimes
Only in rodinia_3.1-patched/opencl/cfd: density
Only in rodinia_3.1-patched/opencl/cfd: density_energy
Only in rodinia_3.1-patched/opencl/cfd: euler3d
diff -ru rodinia_3.1/opencl/cfd/euler3d.cpp rodinia_3.1-patched/opencl/cfd/euler3d.cpp
--- rodinia_3.1/opencl/cfd/euler3d.cpp	2015-12-11 16:46:29.000000000 +0100
+++ rodinia_3.1-patched/opencl/cfd/euler3d.cpp	2016-07-21 15:23:37.820448447 +0200
@@ -12,6 +12,9 @@
 	on 24/03/2011
 ********************************************************************/
 
+#include <sys/time.h>
+static struct timeval t_start, t_end;
+
 #include <iostream>
 #include <fstream>
 #include <math.h>
@@ -22,7 +25,7 @@
  * 
  */ 
 #define GAMMA 1.4f
-#define iterations 2000
+#define iterations 1300
 #ifndef block_length
 	#define block_length 192
 #endif
@@ -345,6 +348,10 @@
 		// these need to be computed the first time in order to compute time step
 		std::cout << "Starting..." << std::endl;
 
+                int runs = atoi(getenv("RODINIA_RUNS"));
+                FILE* runtimes = fopen("runtimes", "w");
+                for (int run = 0; run < runs; run++) {
+                gettimeofday(&t_start, NULL);
 		// Begin iterations
 		for(int i = 0; i < iterations; i++){
 			copy<float>(old_variables, variables, nelr*NVAR);
@@ -358,8 +365,13 @@
 			}
 		}
 		_clFinish();
+                gettimeofday(&t_end, NULL);
+                fprintf(runtimes, "%d\n",
+                        (t_end.tv_sec*1000000+t_end.tv_usec) - (t_start.tv_sec*1000000+t_start.tv_usec));
+                }
+                fclose(runtimes);
 		std::cout << "Saving solution..." << std::endl;
-		dump(variables, nel, nelr);
+                dump(variables, nel, nelr);
 		std::cout << "Saved solution..." << std::endl;
 		_clStatistics();
 		std::cout << "Cleaning up..." << std::endl;
Only in rodinia_3.1-patched/opencl/cfd: momentum
Only in rodinia_3.1-patched/opencl/cfd: PD_OCL.txt
Only in rodinia_3.1-patched/opencl/cfd: runtimes
Binary files rodinia_3.1/opencl/hotspot/hotspot and rodinia_3.1-patched/opencl/hotspot/hotspot differ
diff -ru rodinia_3.1/opencl/hotspot/hotspot.c rodinia_3.1-patched/opencl/hotspot/hotspot.c
--- rodinia_3.1/opencl/hotspot/hotspot.c	2015-12-11 16:46:31.000000000 +0100
+++ rodinia_3.1-patched/opencl/hotspot/hotspot.c	2016-07-21 13:22:27.962339987 +0200
@@ -86,10 +86,13 @@
 	local_work_size[1] = BLOCK_SIZE;
 	
 	
-	long long start_time = get_time();	
-	
+
+        int run;
+        int runs = atoi(getenv("RODINIA_RUNS"));
+        FILE* runtimes = fopen("runtimes", "w");
+        for (run = 0; run < runs; run++) {
+        long long start_time = get_time();
 	for (t = 0; t < total_iterations; t += num_iterations) {
-		
 		// Specify kernel arguments
 		int iter = MIN(num_iterations, total_iterations - t);
 		clSetKernelArg(kernel, 0, sizeof(int), (void *) &iter);
@@ -124,8 +127,9 @@
 	if (error != CL_SUCCESS) fatal_CL(error, __LINE__);
 	
 	long long end_time = get_time();
-	long long total_time = (end_time - start_time);	
-	printf("\nKernel time: %.3f seconds\n", ((float) total_time) / (1000*1000));
+	long long total_time = (end_time - start_time);
+        fprintf(runtimes, "%lld\n", total_time);
+        }
 	
 	return src;
 }
diff -ru rodinia_3.1/opencl/hotspot/run rodinia_3.1-patched/opencl/hotspot/run
--- rodinia_3.1/opencl/hotspot/run	2015-12-11 16:46:31.000000000 +0100
+++ rodinia_3.1-patched/opencl/hotspot/run	2016-07-21 13:28:26.388514452 +0200
@@ -1 +1 @@
-./hotspot 512 2 2 ../../data/hotspot/temp_512 ../../data/hotspot/power_512 output.out
+./hotspot 1024 2 360 ../../data/hotspot/temp_1024 ../../data/hotspot/power_1024 /dev/null
Only in rodinia_3.1-patched/opencl/hotspot: runtimes
Binary files rodinia_3.1/opencl/kmeans/kmeans and rodinia_3.1-patched/opencl/kmeans/kmeans differ
Binary files rodinia_3.1/opencl/kmeans/kmeans_clustering.o and rodinia_3.1-patched/opencl/kmeans/kmeans_clustering.o differ
diff -ru rodinia_3.1/opencl/kmeans/read_input.c rodinia_3.1-patched/opencl/kmeans/read_input.c
--- rodinia_3.1/opencl/kmeans/read_input.c	2015-12-11 16:46:41.000000000 +0100
+++ rodinia_3.1-patched/opencl/kmeans/read_input.c	2016-07-21 16:59:13.542357177 +0200
@@ -82,7 +82,8 @@
 
 extern double wtime(void);
 
-
+#include <sys/time.h>
+static struct timeval t_start, t_end;
 
 /*---< usage() >------------------------------------------------------------*/
 void usage(char *argv0) {
@@ -235,6 +236,12 @@
 	/* ======================= core of the clustering ===================*/
 
     //cluster_timing = omp_get_wtime();		/* Total clustering time */
+
+        int runs = atoi(getenv("RODINIA_RUNS"));
+        int run;
+        FILE* runtimes = fopen("runtimes", "w");
+        for (run = 0; run < runs; run++) {
+          gettimeofday(&t_start, NULL);
 	cluster_centres = NULL;
     index = cluster(npoints,				/* number of data points */
 					nfeatures,				/* number of features for each point */
@@ -246,7 +253,11 @@
 				   &cluster_centres,		/* return: [best_nclusters][nfeatures] */  
 				   &rmse,					/* Root Mean Squared Error */
 					isRMSE,					/* calculate RMSE */
-					nloops);				/* number of iteration for each number of clusters */		
+					nloops);				/* number of iteration for each number of clusters */
+    gettimeofday(&t_end, NULL);
+    fprintf(runtimes, "%d\n",
+            (t_end.tv_sec*1000000+t_end.tv_usec) - (t_start.tv_sec*1000000+t_start.tv_usec));
+        }
     
 	//cluster_timing = omp_get_wtime() - cluster_timing;
 
Binary files rodinia_3.1/opencl/kmeans/read_input.o and rodinia_3.1-patched/opencl/kmeans/read_input.o differ
Only in rodinia_3.1-patched/opencl/kmeans: runtimes
Only in rodinia_3.1/opencl/kmeans: unistd.h
diff -ru rodinia_3.1/opencl/lavaMD/kernel/kernel_gpu_opencl_wrapper.c rodinia_3.1-patched/opencl/lavaMD/kernel/kernel_gpu_opencl_wrapper.c
--- rodinia_3.1/opencl/lavaMD/kernel/kernel_gpu_opencl_wrapper.c	2015-12-11 16:46:33.000000000 +0100
+++ rodinia_3.1-patched/opencl/lavaMD/kernel/kernel_gpu_opencl_wrapper.c	2016-07-21 19:06:48.048045361 +0200
@@ -1,3 +1,6 @@
+#include <sys/time.h>
+static struct timeval t_start, t_end;
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -403,6 +406,11 @@
 	//	KERNEL
 	//======================================================================================================================================================150
 
+        int runs = atoi(getenv("RODINIA_RUNS"));
+        int run;
+        FILE* runtimes = fopen("runtimes", "w");
+        for (run = 0; run < runs; run++) {
+        gettimeofday(&t_start, NULL);
 	// ???
 	clSetKernelArg(	kernel, 
 					0, 
@@ -446,7 +454,10 @@
 	error = clFinish(command_queue);
 	if (error != CL_SUCCESS) 
 		fatal_CL(error, __LINE__);
-
+        gettimeofday(&t_end, NULL);
+        fprintf(runtimes, "%d\n",
+                (t_end.tv_sec*1000000+t_end.tv_usec) - (t_start.tv_sec*1000000+t_start.tv_usec));
+        }
 	time4 = get_time();
 
 	//======================================================================================================================================================150
Only in rodinia_3.1-patched/opencl/lavaMD/kernel: kernel_gpu_opencl_wrapper.o
Only in rodinia_3.1-patched/opencl/lavaMD: lavaMD
Only in rodinia_3.1-patched/opencl/lavaMD: main.o
Only in rodinia_3.1-patched/opencl/lavaMD: runtimes
Only in rodinia_3.1-patched/opencl/lavaMD/util/num: num.o
Only in rodinia_3.1-patched/opencl/lavaMD/util/opencl: opencl.o
Only in rodinia_3.1-patched/opencl/lavaMD/util/timer: timer.o
diff -ru rodinia_3.1/opencl/nn/nearestNeighbor.cpp rodinia_3.1-patched/opencl/nn/nearestNeighbor.cpp
--- rodinia_3.1/opencl/nn/nearestNeighbor.cpp	2015-12-11 16:46:29.000000000 +0100
+++ rodinia_3.1-patched/opencl/nn/nearestNeighbor.cpp	2016-07-21 13:39:36.360797098 +0200
@@ -3,6 +3,9 @@
 
 #include "nearestNeighbor.h"
 
+#include <sys/time.h>
+static struct timeval t_start, t_end;
+
 cl_context context=NULL;
 
 int main(int argc, char *argv[]) {
@@ -37,11 +40,20 @@
   if (resultsCount > numRecords) resultsCount = numRecords;
 
   context = cl_init_context(platform,device,quiet);
-  
-  recordDistances = OpenClFindNearestNeighbors(context,numRecords,locations,lat,lng,timing);
-
-  // find the resultsCount least distances
-  findLowest(records,recordDistances,numRecords,resultsCount);
+  int run;
+  int runs = atoi(getenv("RODINIA_RUNS"));
+  FILE* runtimes = fopen("runtimes", "w");
+  for (run = 0; run < runs; run++) {
+    gettimeofday(&t_start, NULL);
+    recordDistances = OpenClFindNearestNeighbors(context,numRecords,locations,lat,lng,timing);
+
+    // find the resultsCount least distances
+    findLowest(records,recordDistances,numRecords,resultsCount);
+    gettimeofday(&t_end, NULL);
+    fprintf(runtimes,
+            "%d\n",
+            (t_end.tv_sec*1000000+t_end.tv_usec) - (t_start.tv_sec*1000000+t_start.tv_usec));
+  }
 
   // print out results
   if (!quiet)
Binary files rodinia_3.1/opencl/nn/nn and rodinia_3.1-patched/opencl/nn/nn differ
diff -ru rodinia_3.1/opencl/nn/run rodinia_3.1-patched/opencl/nn/run
--- rodinia_3.1/opencl/nn/run	2015-12-11 16:46:30.000000000 +0100
+++ rodinia_3.1-patched/opencl/nn/run	2016-07-21 13:41:37.878917445 +0200
@@ -1 +1 @@
-./nn filelist.txt -r 5 -lat 30 -lng 90
\ No newline at end of file
+./nn filelist.txt -r 100 -lat 30 -lng 90 -d 0 -p 0
Only in rodinia_3.1-patched/opencl/nn: runtimes
diff -ru rodinia_3.1/opencl/srad/kernel/kernel_gpu_opencl_wrapper.c rodinia_3.1-patched/opencl/srad/kernel/kernel_gpu_opencl_wrapper.c
--- rodinia_3.1/opencl/srad/kernel/kernel_gpu_opencl_wrapper.c	2015-12-11 16:46:39.000000000 +0100
+++ rodinia_3.1-patched/opencl/srad/kernel/kernel_gpu_opencl_wrapper.c	2016-07-21 13:05:22.190711431 +0200
@@ -1,3 +1,9 @@
+#include <stdlib.h>
+#include <sys/time.h>
+#include <error.h>
+#include <errno.h>
+static struct timeval t_start, t_end;
+
 //========================================================================================================================================================================================================200
 //	DEFINE/INCLUDE
 //========================================================================================================================================================================================================200
@@ -537,7 +543,11 @@
 	//====================================================================================================100
 	//	set arguments
 	//====================================================================================================100
-
+        FILE* runtimes = fopen("runtimes", "w");
+        int runs = atoi(getenv("RODINIA_RUNS"));
+        int i;
+        for (i = 0; i < runs; i++) {
+gettimeofday(&t_start, NULL);
 	error = clSetKernelArg(	extract_kernel, 
 							0, 
 							sizeof(long), 
@@ -1024,6 +1034,14 @@
 		//====================================================================================================100
 
 	}
+        error = clFinish(command_queue);
+	if (error != CL_SUCCESS)
+          fatal_CL(error, __LINE__);
+
+        gettimeofday(&t_end, NULL);
+        fprintf(runtimes, "%d\n",
+                (t_end.tv_sec*1000000+t_end.tv_usec) - (t_start.tv_sec*1000000+t_start.tv_usec));
+        }
 
 	printf("\n");
 
Binary files rodinia_3.1/opencl/srad/kernel/kernel_gpu_opencl_wrapper.o and rodinia_3.1-patched/opencl/srad/kernel/kernel_gpu_opencl_wrapper.o differ
diff -ru rodinia_3.1/opencl/srad/main.c rodinia_3.1-patched/opencl/srad/main.c
--- rodinia_3.1/opencl/srad/main.c	2015-12-11 16:46:39.000000000 +0100
+++ rodinia_3.1-patched/opencl/srad/main.c	2016-07-21 13:01:45.145788103 +0200
@@ -222,12 +222,14 @@
 	// 	WRITE OUTPUT IMAGE TO FILE
 	//======================================================================================================================================================150
 
-	write_graphics(	"./output/image_out.pgm",
-					image,
-					Nr,
-					Nc,
-					1,
-					255);
+        if (0) { // Disabled for benchmarking
+          write_graphics(	"./output/image_out.pgm",
+                                image,
+                                Nr,
+                                Nc,
+                                1,
+                                255);
+        }
 
 	time5 = get_time();
 
@@ -258,6 +260,7 @@
 	printf("Total time:\n");
 	printf("%.12f s\n", 																(fp) (time5-time0) / 1000000);
 
+        return 0;
 }
 
 //========================================================================================================================================================================================================200
Binary files rodinia_3.1/opencl/srad/main.o and rodinia_3.1-patched/opencl/srad/main.o differ
Only in rodinia_3.1-patched/opencl/srad: runtimes
Binary files rodinia_3.1/opencl/srad/srad and rodinia_3.1-patched/opencl/srad/srad differ
diff -ru rodinia_3.1/README rodinia_3.1-patched/README
--- rodinia_3.1/README	2016-07-21 13:04:10.366173343 +0200
+++ rodinia_3.1-patched/README	2016-07-21 13:04:30.407728141 +0200
@@ -1,3 +1,6 @@
+NOTICE: this tree has been modified by the futhark-ppopp17 Makefile
+to add consistent timing to some benchmark implementations.
+
 Rodinia Benchmark Suite 3.1
 ===========================
 
Only in rodinia_3.1-patched/: rodinia_3.1
